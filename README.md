# GENET: Automatic Curriculum Generation for Learning Adaptation in Networking

## Installation

### Operating system information
Simulation and training experiments were done in a Ubuntu server with
- **Kernal version**: #184-Ubuntu SMP Thu Mar 24 17:48:36 UTC 2022
- **CPU INFO**:
    - Architecture:        x86_64
    - CPU(s):              32
    - Model name:          Intel(R) Xeon(R) Silver 4110 CPU @ 2.10GHz


### Download the source code

```bash
git clone git@github.com:zxxia/PCC-RL.git
```

### Set up python virtual environment
- Python3 Virtual environment is highly recommended. Select one of the
  following to set up a python3 virtual environment. 
  - [venv](https://docs.python.org/3.7/library/venv.html) only
  ```bash
  python3 -m venv genet
  echo "[absolute path]/PCC-RL/src" > genet/lib/[python version]/genet.pth
  source genet/bin/activate
  ```
  - [virtualenv](https://virtualenv.pypa.io/en/latest/) only
  ```bash
  virtualenv -p python3 genet
  echo "[absolute path]/PCC-RL/src" > genet/lib/[python version]/genet.pth
  source genet/bin/activate
  ```
  - [virtualenv](https://virtualenv.pypa.io/en/latest/) and [virtualenvwrapper](https://virtualenvwrapper.readthedocs.io/en/latest/)
  ```bash
  mkvirtualenv -a PCC-RL/ -p python3 genet
  workon genet
  add2virtualenv src/
  ```
- Now the virtual environment is activated.

## Installation

```bash
cd PCC-RL
bash install.sh
```

<!-- - Add `src` to `$PYTHONPATH` by running -->
<!--  -->
<!--     ```bash -->
<!--     cd PCC-RL -->
<!--     export PYTHONPATH="${PYTHONPATH}:$(pwd)/src" -->
<!--     ``` -->

## Traces

### Real Traces

Real traces are recorded on Pantheon platform and they can be downloaded from
[Pantheon](https://pantheon.stanford.edu/measurements/node/). There are three
connection types: cellular, ethernet, and wifi. The path to store them is
`PCC-RL/data/${connection_type}`

### Syntheic Traces

Generated by `PCC-RL/src/simulator/trace.py`

## Configuration files

The configurations are stored at `PCC-RL/config/train`

## Training

### udr training

```bash
cd src/simulator
# run on CPU only if CUDA & GPU(s) are installed and use 2 workers
CUDA_VISIBLE_DEVICES="" mpiexec -np 2 python train_rl.py \
    --save-dir ${save_dir} \
    --total-timesteps 1000000 \
    --randomization-range-file ${path_to_config_file} \
    --seed ${seed} \
    --pretrained-model-path ${path_to_pretrained_model}
```

### genet training

```bash
cd src/simulator
CUDA_VISIBLE_DEVICES="" python genet_improved.py \
    --seed ${seed} \
    --heuristic ${rule_based_method_name} \
    --save-dir ${save_dir}/ \
    --config-file ${path_to_config_file} \
    --bo-rounds ${n_bo} \
    --model-path ${path_to_pretrained_model}
```

### Rule-based baselines

- BBR: [paper](https://www.cis.upenn.edu/~cis553/files/BBR.pdf),
  [code](https://github.com/google/bbr),
  [implentation in simulator](src/simulator/network_simulator/bbr.py)
- Copa:
  [paper](https://www.usenix.org/system/files/conference/nsdi18/nsdi18-arun.pdf),
  [code](https://github.com/venkatarun95/genericCC)
- Cubic:
  [paper](https://www.cs.princeton.edu/courses/archive/fall16/cos561/papers/Cubic08.pdf),
  [code](https://git.kernel.org/pub/scm/linux/kernel/git/netdev/net-next.git/tree/net/ipv4/tcp_cubic.c),
  [implentation in simulator](src/simulator/network_simulator/cubic.py)
- PCC-Vivace:
  [paper](https://www.usenix.org/system/files/conference/nsdi18/nsdi18-dong.pdf),
  [code](https://github.com/PCCproject/PCC-Uspace),
  [implentation in simulator](src/simulator/network_simulator/pcc/vivace/vivace_latency.py)

<!-- ## Overview -->
<!--  -->
<!-- This repo contains the gym environment required for training reinforcement -->
<!-- learning models used in the PCC project along with the Python module required to -->
<!-- run RL models in the PCC UDT codebase found at github.com/PCCProject/PCC-Uspace. -->
<!--  -->
<!--  -->
<!-- ## Training -->
<!-- To run training only, go to ./src/gym/, install any missing requirements for -->
<!-- stable\_solve.py and run that script. By default, this should replicate the -->
<!-- model presented in A Reinforcement Learning Perspective on Internet Congestion -->
<!-- Control, ICML 2019. -->
<!--  -->
<!-- ## Testing Models -->
<!--  -->
<!-- To test models in the real world (i.e., sending real packets into the Linux -->
<!-- kernel and out onto a real or emulated network), download and install the PCC -->
<!-- UDT code from github.com/PCCProject/PCC-Uspace. Follow the instructions in that -->
<!-- repo for using congestion control algorithms with Python modules, and see -->
<!-- ./src/gym/online/README.md for additional instructions regarding testing or training models in the real world. -->
